<!DOCTYPE html>
<html>
<head>
    <title>Attendance Dashboard</title>
    <style>
/* =====================
   RESET & VARIABLES
===================== */
:root{
    --primary:#667eea;
    --secondary:#764ba2;
    --accent:#43e97b;
    --danger:#ff0844;
    --glass:rgba(255,255,255,0.15);
}

*{
    margin:0;
    padding:0;
    box-sizing:border-box;
}

/* =====================
   BODY WITH IMAGE + ANIMATION
===================== */
body{
    font-family:"Segoe UI", Tahoma, sans-serif;
    min-height:100vh;
    display:flex;
    flex-direction:column;
    align-items:center;
    background:
        linear-gradient(135deg, rgba(102,126,234,0.85), rgba(118,75,162,0.85)),
        url("https://images.unsplash.com/photo-1523050854058-8df90110c9f1");
    background-size:cover;
    background-position:center;
    animation:bgMove 20s linear infinite alternate;
}

/* Soft background movement */
@keyframes bgMove{
    from{background-position:0% 50%;}
    to{background-position:100% 50%;}
}

/* =====================
   TITLE
===================== */
h1 {
    color: #ffffff;
    text-shadow:
        0 0 5px black,
        0 0 10px #292323,
        0 0 20px darkgray;
    margin-top: 10px;
}



/* =====================
   THUMBNAIL CONTAINER
===================== */
#thumbnailContainer{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    margin:30px 0;
    width:100%;
    padding:10px;
}

/* =====================
   THUMBNAIL CARD
===================== */
.thumbnail{
    position:relative;
    cursor:pointer;
    margin:14px;
    padding:22px;
    min-width:190px;
    border-radius:20px;
    text-align:center;
    font-size:20px;
    font-weight:bold;
    color:white;

    background: rgba(30,30,60,0.25);
    backdrop-filter: blur(14px) saturate(180%);
    -webkit-backdrop-filter: blur(14px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.15);

    box-shadow:
        0 16px 32px rgba(0,0,0,0.45),
        inset 0 0 16px rgba(255,255,255,0.12);

    transition: transform 0.4s ease, box-shadow 0.4s ease, border 0.3s ease;
}


.thumbnail::before{
    content:"";
    position:absolute;
    inset:-2px;
    border-radius:22px;
    background:linear-gradient(
        135deg,
        #4440fc,
        purple
    );
    opacity:0;
    filter:blur(12px);
    transition:opacity 0.4s ease;
    z-index:-1;
}

.thumbnail:hover::before{
    opacity:1;
}

.thumbnail:hover{
    transform:translateY(-10px) scale(1.1);
    box-shadow:0 28px 55px rgba(0,0,0,0.65);
}


.thumbnail.high-attendance{
    border-color: #00ff7f;
    box-shadow:
        0 16px 32px rgba(0,255,127,0.6),
        inset 0 0 20px rgba(0,255,127,0.3);
}

.thumbnail.low-attendance{
    border-color: #ff1744;
    box-shadow:
        0 16px 32px rgba(255,23,68,0.6),
        inset 0 0 20px rgba(255,23,68,0.3);
}


.thumbnail div{
    text-shadow:
        0 0 6px rgba(0,255,255,0.6),
        0 0 12px rgba(0,255,255,0.3);
}


.thumb-info{
    font-size:14px;
    color:#e0ffff;
    text-shadow:0 0 4px rgba(0,255,255,0.5);
}
/* =====================
   DELETE BUTTON
===================== */
.delete-thumb-btn{
    position:absolute;
    top:6px;
    right:6px;
    width:26px;
    height:26px;
    border-radius:50%;
    border:none;
    cursor:pointer;
    font-weight:bold;
    color:white;
    background:linear-gradient(135deg,#ff0844,#ff512f);
    box-shadow:0 4px 10px rgba(0,0,0,0.5);
    transition:0.3s;
}

.delete-thumb-btn:hover{
    transform:scale(1.2) rotate(90deg);
}

/* =====================
   THUMB INFO
===================== *
/* =====================
   CENTER BUTTON
===================== */
.center-container{
    margin-bottom:50px;
}

button.new-btn{
    font-size:clamp(22px,4vw,36px);
    padding:22px 55px;
    border:none;
    border-radius:16px;
    cursor:pointer;
    font-weight:bold;
    color:#003;

    background:linear-gradient(
        135deg,
        #43e97b,
        #38f9d7,
        #4facfe
    );

    box-shadow:
        0 15px 35px rgba(0,0,0,0.4),
        inset 0 0 10px rgba(255,255,255,0.4);

    transition:all 0.4s ease;
}

/* Pulse animation */
button.new-btn:hover{
    transform:scale(1.12);
    box-shadow:0 25px 45px rgba(0,0,0,0.6);
}

/* =====================
   RESPONSIVE
===================== */
@media(max-width:600px){

    h1{
        margin-top:25px;
    }

    .thumbnail{
        min-width:85%;
        font-size:18px;
    }

    button.new-btn{
        width:90%;
        padding:18px;
    }
}
/* =====================
   COLORFUL FOOTER
===================== */
/* =====================
   COLORFUL FOOTER
===================== */
.footer {
    position: relative;
    width: 97%;
    margin-top: 25px;
    margin-bottom: 20px;
    overflow: hidden; /* hide overflowing text */
    max-height: 700px; /* default height */
    padding: 20px 20px;
    background: linear-gradient(
        135deg,
        purple,
        #667eea,
        #00f2fe,
        #11998e,
        #38ef7d
    );
    background-size: 300% 300%;
    animation: footerGradient 8s ease infinite;
    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.2);
    color: white;
    border-radius: 12px;
    transition: max-height 0.5s ease, padding 0.5s ease;
}


/* Footer text */
.footer div {
    font-weight: 600;
    color: #ffeb3b;
    margin-bottom: 8px;
}

/* Footer links */
.footer-links {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 5px;
}

.footer-links a {
    color: yellow;
    font-weight: bold;
    text-decoration: none;
    position: relative;
    transition: 0.3s;
}

.footer-links a::after {
    content: "";
    width: 0%;
    height: 2px;
    position: absolute;
    left: 0;
    bottom: -2px;
    background: linear-gradient(to right, yellow, greenyellow);
    transition: 0.4s ease-in-out;
}

.footer-links a:hover::after {
    width: 100%;
}


/* Footer links */


/* Responsive footer */
@media(max-width:600px){
    footer{
        font-size:13px;
        padding:20px 10px;
    }
}
.center-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px; /* spacing between top and bottom button rows */
}

/* Top row: Export + Import */
.top-buttons {
    display: flex;
    gap: 15px;
}

/* Bottom row: New / Next Session + Delete All */
.bottom-buttons {
    display: flex;
    gap: 15px;
}

/* Optional: Style Export and Import buttons differently */
.top-buttons .new-btn {
    background: linear-gradient(135deg, #43e97b, #4facfe);
    color: #003;
    font-size: clamp(16px, 2vw, 22px);
    padding: 12px 28px;
}

/* New / Delete buttons */
/* Export button */
.export-btn {
    background: linear-gradient(135deg, yellow, #34E89E);
    color: white;
    border: none;
    font-size: 20px;
    letter-spacing:1px;
    margin-top: 10px;
}

/* Import button */
.import-btn {
    background: linear-gradient(135deg, #FF6B6B, orange);
    color: white;
    border: none;
    font-size: 20px;
    letter-spacing: 1px;
    margin-top: 10px;
}

/* Shared style */
.export-btn, .import-btn {
    padding: 12px 24px;
    border-radius: 12px;
    font-weight: bold;
    box-shadow: 0 8px 18px rgba(0,0,0,0.25);
    transition: 0.3s ease;
}

.export-btn:hover, .import-btn:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 26px rgba(0,0,0,0.30);
}
header {
    position: fixed;
    top: 0;
    left: 0;

    width: auto;
    max-width: 100%;
    padding: 12px 18px;

    display: flex;
    align-items: center;
    gap: 20px;

    background: rgba(30,30,60,0.25);
    backdrop-filter: blur(14px) saturate(180%);
    -webkit-backdrop-filter: blur(14px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.18);
    border-radius: 0 0 15px 0;

    box-shadow: 0 12px 26px rgba(0, 0, 0, 0.31);
    z-index: 1000;
    transition: 0.5s;
}

@media (max-width: 600px) {
    header {
        width: 100%;
        justify-content: space-between;
        border-radius: 0;
        padding: 10px 14px;
    }

    header h1 {
        font-size: 18px;
    }

    .logout-btn {
        font-size: 14px;
        padding: 8px 12px;
        width: auto;
        margin: 0;
    }
    body {
    padding-top: 70px;
}

}

header:hover{
    transform: translateX(3px);
}
header h1 {
    margin: 0;
    line-height: 1.2;
    font-size: 24px;
}

.logout-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    background: linear-gradient(135deg, #ff6a00, #ee0979, #8e2de2);
    box-shadow: 2px 2px 20px rgb(0, 0, 0); 
    color: white;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s;
    margin-top: 10px;
    margin-left: 20px;
    width: 150px;
    font-size: 20px;
}
.logout-btn:hover {
    transform: translateY(-2px);
}
</style>
</head>
<body>
<header>
    <h1 id="welcomeMsg">Welcome</h1>
    <button class="logout-btn" onclick="logout()">Logout</button>
</header>
<div class="title-container">
    <h1>ðŸ“‹ Student Attendance Register</h1>
</div>

<div id="thumbnailContainer"></div>

<div class="center-container">
    <div class="bottom-buttons">
        <button class="new-btn" onclick="createNewSession()">New / Next Session</button>
    </div>
    <button class="new-btn" id="deleteAllBtn" style="background:linear-gradient(135deg,#ff0844,#ff512f)"
     onclick="deleteAllSessions()">Delete All</button>
    <div class="top-buttons">
        <button class="export-btn" onclick="exportBackup()">Export Backup</button>
        <input type="file" id="importFile" onchange="importBackup(event)" style="display:none">
        <button class="import-btn" onclick="document.getElementById('importFile').click()">Import Backup</button>
    </div>
</div>
<div class="footer">
    <div>Â© 2025 <span>Attendance Manager</span> â€” All Rights Reserved</div>
<p style="color:#fff;">âœ” Efficiently track attendance for all your students.</p>
<p style="color:#fff;">âœ” Add, delete, or update student details with ease.</p>
<p style="color:#fff;">âœ” Mark students as Present or Absent in just a few clicks.</p>
<p style="color:#fff;">âœ” Manage multiple sessions for different dates effortlessly.</p>
<p style="color:#fff;">âœ” Data is saved locally in your browser using LocalStorage â€” no internet required.</p>
<p style="color:#fff;">âœ” Responsive design works seamlessly on both desktop and mobile devices.</p>
<p style="color:#fff;">âœ” Context menu allows quick actions like renaming, changing roll numbers, or repositioning students.</p>
<p style="color:#fff;">âœ” Visually appealing gradient backgrounds and colorful buttons for easy interaction.</p>
<p>âœ” Export Backup: Save all attendance data to a file for backup or transfer.</p>
<p>âœ” Import Backup: Load a previously saved backup to restore attendance records.</p>
<p>âœ” Make sure the file is from this app for a successful import.</p>

    <div class="footer-links">
        <a href="at.html">Home</a>
        <a href="index.html">Attendance Page</a>
    </div>
</div>


</div>

<script>
function logout(){
    window.location.href = "login.html";
}
</script>

<script>
const newbtn = document.querySelector(".new-btn");
function loadThumbnails() {
    const container = document.getElementById("thumbnailContainer");
    container.innerHTML = "";

    let hasSessions = false; // flag to check if there are any sessions

    Object.keys(localStorage).forEach(key => {
        if (key.startsWith("students_")) {
            const sessionId = key.replace("students_", "");
            const date = localStorage.getItem("attendanceDate_" + sessionId);
            if (!date) return;

            hasSessions = true; // we found at least one session

            const thumb = document.createElement("div");
            thumb.className = "thumbnail";

            // Show full date
            const dateText = document.createElement("div");
            dateText.innerText = `Date: ${date}`;
            dateText.style.fontSize = "18px";
            dateText.style.marginBottom = "5px";
            thumb.appendChild(dateText);

            // Count present students
            const students = JSON.parse(localStorage.getItem("students_" + sessionId)) || [];
            const presentCount = students.filter(s => s.status === "Present").length;
            const presentText = document.createElement("div");
            presentText.innerText = `Presents: ${presentCount}`;
            presentText.style.fontSize = "18px";
            thumb.appendChild(presentText);

            // Delete button
            const delBtn = document.createElement("button");
            delBtn.className = "delete-thumb-btn";
            delBtn.innerText = "X";
            delBtn.addEventListener("click", e => {
                e.stopPropagation();
                if (confirm("Delete this session?")) {
                    localStorage.removeItem("students_" + sessionId);
                    localStorage.removeItem("attendanceDate_" + sessionId);
                    loadThumbnails(); // reload after deletion
                }
            });
            thumb.appendChild(delBtn);

            // Click to open session
            thumb.addEventListener("click", () => {
                localStorage.setItem("currentSessionId", sessionId);
                window.location.href = "index.html";
            });
            container.appendChild(thumb);
            // Calculate attendance ratio
let attendanceRatio = students.length > 0 ? presentCount / students.length : 0;

// Remove previous glow classes (if any)
thumb.classList.remove("high-attendance", "low-attendance");

// Apply neon glow based on ratio
if(attendanceRatio >= 0.75){ // 75% or more present â†’ green
    thumb.classList.add("high-attendance");
} else if(attendanceRatio < 0.5){ // less than 50% â†’ red
    thumb.classList.add("low-attendance");
}

        }

    });

    // Update center button text
    const centerButton = document.querySelector(".center-container .new-btn");
    if (centerButton) {
        centerButton.innerText = hasSessions ? "Next Session" : "New";
    }
    // Show or hide "Delete All" button
    // Count total thumbnails (sessions)
    const totalSessions = Object.keys(localStorage).filter(key => key.startsWith("students_")).length;

    // Show delete button only if there are 2 or more sessions
    const deleteBtn = document.getElementById("deleteAllBtn");
    if(deleteBtn){
        deleteBtn.style.display = totalSessions > 1 ? "inline-block" : "none";
    }

}


// EXPORT
function exportBackup() {
    const backup = {};

    Object.keys(localStorage).forEach(key => {
        if (key.startsWith("students_") || key.startsWith("attendanceDate_") || key === "lastSessionId" || key === "currentSessionId") {
            backup[key] = localStorage.getItem(key);
        }
    });

    const dataStr = JSON.stringify(backup, null, 2);
    const blob = new Blob([dataStr], { type: "application/json" });
    const url = URL.createObjectURL(blob);

    const a = document.createElement("a");
    a.href = url;
    a.download = "attendance_backup.json";
    a.click();
    URL.revokeObjectURL(url);
}

// IMPORT
function importBackup(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const data = JSON.parse(e.target.result);

            // Clear old relevant data
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith("students_") || key.startsWith("attendanceDate_") || key === "lastSessionId" || key === "currentSessionId") {
                    localStorage.removeItem(key);
                }
            });

            // Restore backup
            Object.keys(data).forEach(key => {
                localStorage.setItem(key, data[key]);
            });

            // Set lastSessionId to latest session
            const studentKeys = Object.keys(data).filter(k => k.startsWith("students_"));
            if (studentKeys.length > 0) {
                const latestSession = studentKeys
                    .map(k => k.replace("students_", ""))
                    .sort((a, b) => Number(a) - Number(b))
                    .pop();

                localStorage.setItem("lastSessionId", latestSession);
            }

            alert("Backup imported successfully!");
            loadThumbnails(); // refresh thumbnails
        } catch(err) {
            console.error(err);
            alert("Invalid backup file!");
        }
    };
    reader.readAsText(file);
}

// DELETE ALL
function deleteAllSessions() {
    if (!confirm("Are you sure you want to delete ALL attendance sessions?")) return;

    Object.keys(localStorage).forEach(key => {
        if (key.startsWith("students_") || key.startsWith("attendanceDate_") || key === "lastSessionId" || key === "currentSessionId") {
            localStorage.removeItem(key);
        }
    });

    loadThumbnails();
}



function createNewSession() {
    // Generate new session ID
    const newSessionId = Date.now();
    localStorage.setItem("currentSessionId", newSessionId);

    // Copy students from last session if exists
    const lastSessionId = localStorage.getItem("lastSessionId");
    let students = [];
    if (lastSessionId) {
        const lastStudents = JSON.parse(localStorage.getItem("students_" + lastSessionId)) || [];
        students = lastStudents.map(s => ({ roll: s.roll, name: s.name, status: "Not Marked" }));
    }

    // Save new session
    localStorage.setItem("students_" + newSessionId, JSON.stringify(students));

    // Set today's date
    const today = new Date().toISOString().split("T")[0];
    localStorage.setItem("attendanceDate_" + newSessionId, today);

    // Update last session
    localStorage.setItem("lastSessionId", newSessionId);

    // Open index.html
    window.location.href = "index.html";
}
function deleteAllSessions() {
    if (!confirm("Are you sure you want to delete ALL attendance sessions?")) {
        return;
    }

    // Loop through localStorage keys
    Object.keys(localStorage).forEach(key => {
        if (
            key.startsWith("students_") ||
            key.startsWith("attendanceDate_") ||
            key === "currentSessionId" ||
            key === "lastSessionId"
        ) {
            localStorage.removeItem(key);
        }
    });

    // Reload thumbnails
    loadThumbnails();
}
// Display welcome message
const username = localStorage.getItem("loginUser") || "User";
document.getElementById("welcomeMsg").innerText = `Welcome, ${username}`;

// Logout function
function logout() {
    if(confirm("Are you sure you want to logout? This will reset your username and password.")){
        localStorage.removeItem("loginUser");
        localStorage.removeItem("loginPass");
        window.location.href = "login.html"; // redirect to login page
    }
}
// Load thumbnails
window.addEventListener("load", loadThumbnails);
</script>

</body>
</html>
