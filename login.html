<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Login Page</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
/* ============================================
   CSS VARIABLES & RESET
============================================ */
:root {
    --bg: #f5f7fb;
    --card: #ffffff;
    --primary: #2563eb;
    --secondary: #764ba2;
    --primary-hover: #1e40af;
    --danger: #dc2626;
    --success: #16a34a;
    --text: #1f2937;
    --muted: #6b7280;
    --border: #e5e7eb;
    --border-focus: #2563eb;
    --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 12px 30px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

* {
    box-sizing: border-box;
    font-family: "Segoe UI", Tahoma, sans-serif;
}

/* ============================================
   BODY & LAYOUT
============================================ */
body,
html {
    margin: 0;
    min-height: 100vh;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    display: flex;
    align-items: center;
    justify-content: center;
}

/* ============================================
   CONTAINER
============================================ */
.container {
    width: 100%;
    max-width: 420px;
    padding: 20px;
}

.login-box {
    background: var(--card);
    padding: 40px;
    border-radius: 18px;
    box-shadow: var(--shadow-lg);
    text-align: center;
}

/* ============================================
   TITLE
============================================ */
.login-box h2 {
    margin-bottom: 25px;
    color: var(--text);
    font-size: 28px;
    font-weight: 600;
}

/* ============================================
   INPUT FIELDS
============================================ */
.input-container {
    position: relative;
    margin-bottom: 16px;
}

.input-container input {
    width: 100%;
    padding: 14px 42px 14px 14px;
    border-radius: 10px;
    border: 1px solid var(--border);
    font-size: 15px;
    transition: var(--transition);
}

.input-container input:focus {
    border-color: var(--border-focus);
    outline: none;
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
}

/* ============================================
   PASSWORD TOGGLE
============================================ */
.toggle-password {
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    cursor: pointer;
    color: var(--muted);
    transition: var(--transition);
}

.toggle-password:hover {
    color: var(--primary);
}

/* ============================================
   BUTTONS
============================================ */
.login-box button {
    width: 100%;
    padding: 14px;
    border-radius: 10px;
    border: none;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    margin-top: 10px;
    transition: var(--transition);
}

.login-box button:first-of-type {
    background: var(--primary);
    color: white;
}

.login-box button:first-of-type:hover {
    background: var(--primary-hover);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
}

#changePassBtn {
    background: #374151;
    color: white;
}

#changePassBtn:hover {
    background: #1f2937;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(55, 65, 81, 0.3);
}

#forgotPassBtn {
    background: var(--muted);
    color: white;
}

#forgotPassBtn:hover {
    background: #4b5563;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
}

/* ============================================
   MESSAGE
============================================ */
#message {
    margin-top: 14px;
    font-size: 14px;
    color: var(--danger);
    min-height: 20px;
}

/* ============================================
   RESPONSIVE DESIGN
============================================ */
@media (max-width: 480px) {
    .container {
        padding: 15px;
    }

    .login-box {
        padding: 25px;
    }

    .login-box h2 {
        font-size: 24px;
    }
}
</style>
</head>
<body>

<div class="container">
  <div class="login-box">
    <h2 id="loginTitle">Login</h2>

    <div class="input-container" id="usernameContainer">
      <input type="text" id="username" placeholder="Username">
    </div>

    <div class="input-container">
      <input type="password" id="password" placeholder="Password">
      <span class="toggle-password" onclick="togglePassword()"><i class="fa-solid fa-eye"></i></span>
    </div>

    <button onclick="login()">Login</button>
    <button id="changePassBtn" onclick="changePassword()">Change Password</button>
    <!-- Add this inside your .login-box div -->
    <button id="forgotPassBtn" onclick="forgotPassword()">Forgot Password</button>



    <p id="message"></p>
  </div>
</div>

<script>
let storedUser = localStorage.getItem("loginUser");
let storedPass = localStorage.getItem("loginPass");
let attempts = 0;

window.onload = function(){
    if(storedUser){
        document.getElementById("usernameContainer").style.display = "none";
        document.getElementById("loginTitle").innerText = "Welcome, " + storedUser;
    } else {
        document.getElementById("loginTitle").innerText = "Set Your Username & Password";
    }
}

function togglePassword() {
    const passInput = document.getElementById("password");
    const icon = document.querySelector(".toggle-password i");
    if(passInput.type === "password") {
        passInput.type = "text";
        icon.classList.replace("fa-eye", "fa-eye-slash");
    } else {
        passInput.type = "password";
        icon.classList.replace("fa-eye-slash", "fa-eye");
    }
}

function login() {
    const userInput = document.getElementById("username").value.trim();
    const passInput = document.getElementById("password").value.trim();

    // First-time setup
if(!storedUser && !storedPass){
    const userInput = prompt("Set username:");
    const passInput = prompt("Set password:");
    if(!userInput || !passInput) return;

    // Generate a secure random recovery token
    const recoveryToken = Math.random().toString(36).slice(2, 10).toUpperCase(); 
    alert("Save this recovery code safely! You will need it to reset your password: " + recoveryToken);

    localStorage.setItem("loginUser", userInput);
    localStorage.setItem("loginPass", passInput);
    localStorage.setItem("recoveryToken", recoveryToken);
    window.location.href = "at.html";
}

    // Normal login
    if(passInput === storedPass){
        attempts = 0;
        window.location.href = "at.html";
    } else {
        attempts++;
        document.getElementById("message").innerText = "Invalid password!";
        if(attempts >= 3){
            document.getElementById("password").disabled = true;
        }
    }
}


function changePassword() {
    if (!storedUser) {
        document.getElementById("message").innerText = "Set username and password first!";
        return;
    }

    const current = prompt("Enter CURRENT password:");
    if (current === null) return;
    if (current !== storedPass) {
        document.getElementById("message").innerText = "Current password is incorrect!";
        return;
    }

    const newPass = prompt("Enter NEW password:");
    if (!newPass || newPass.trim() === "") {
        document.getElementById("message").innerText = "New password cannot be empty!";
        return;
    }

    const confirmPass = prompt("Confirm NEW password:");
    if (newPass !== confirmPass) {
        document.getElementById("message").innerText = "Passwords do not match!";
        return;
    }

    localStorage.setItem("loginPass", newPass.trim());
    storedPass = newPass.trim();
    document.getElementById("message").style.color = "lightgreen";
    document.getElementById("message").innerText = "Password changed successfully!";
}
function isStrongPassword(password) {
    return /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/.test(password);
}

function forgotPassword() {
    const storedToken = localStorage.getItem("recoveryToken");
    if(!storedToken){
        alert("No recovery code found. You cannot reset the password.");
        return;
    }

    const inputToken = prompt("Enter your recovery code (shown during setup):");
    if(inputToken !== storedToken){
        alert("Recovery code incorrect. Cannot reset password!");
        return;
    }

    // New password
    const newPass = prompt("Enter new password (strong recommended):");
    if(!newPass || newPass.trim().length < 8){
        alert("Password too short!");
        return;
    }

    const confirmPass = prompt("Confirm new password:");
    if(newPass !== confirmPass){
        alert("Passwords do not match!");
        return;
    }

    localStorage.setItem("loginPass", newPass.trim());
    alert("Password reset successfully!");
}

</script>

</body>
</html>
